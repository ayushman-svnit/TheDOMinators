<!DOCTYPE html>
<html>

<head>
    <title>Bus Stop Popover on Hover</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCt8iYH8RfkVHNhBDxrB0mzCuf2jcgI-18"></script>
    <style>
        #map {
            height: 100vh;
            width: 100%;
        }

        /* Optional: Styling the InfoWindow */
        .gm-style-iw-d {
            padding: 10px !important;
            font-size: 14px;
        }

        /* Hide the default close button */
        .gm-ui-hover-effect {
            display: none !important;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: white;
            padding: 20px;
            color: #202124;
        }

        .brts-container {
            max-width: 400px;
            margin: auto;
        }

        .title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 16px;
        }

        .bus-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .bus-icon {
            margin-right: 8px;
            color: #5f6368;

            img {
                height: 20px;
                width: 20px
            }
        }

        .bus-badge {
            font-weight: bold;
            font-size: 14px;
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            min-width: 40px;
            text-align: center;
            margin-right: 10px;
        }

        .badge-blue {
            background-color: #1047ff;
        }

        .badge-red {
            background-color: #db1111;
        }

        .badge-gray {
            background-color: #5f6368;
        }

        .bus-details {
            flex: 1;
        }

        .destination {
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }

        .time {
            font-size: 13px;
            color: #5f6368;
            white-space: nowrap;
        }
    </style>
</head>

<body>
    <div id="map"></div>

<script>
  // Utility function to format a Date object into "HH:MM AM/PM"
  function formatTime(date) {
    let hours = date.getHours();
    let minutes = date.getMinutes();
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12 || 12;
    minutes = minutes < 10 ? '0' + minutes : minutes;
    return `${hours}:${minutes} ${ampm}`;
  }

  // Inserts random times into all .time elements within the given container
  function insertRandomTimes(infoWindowContainer) {
    const timeElements = infoWindowContainer.querySelectorAll('.time');
    const now = new Date();
    // Generate random intervals (0 to 60 minutes) for each bus stop
    const randomMinutes = Array.from({ length: timeElements.length }, () =>
      Math.floor(Math.random() * 61)
    );
    randomMinutes.sort((a, b) => a - b);
    timeElements.forEach((el, i) => {
      const time = new Date(now.getTime() + randomMinutes[i] * 60000);
      el.textContent = formatTime(time);
    });
  }

  function initMap() {
    // Create the map centered on the desired location.
    const map = new google.maps.Map(document.getElementById("map"), {
      center: { lat: 21.1702, lng: 72.8311 },
      zoom: 14,
    });

    const busStop = { lat: 21.16532982224471, lng: 72.78042285530493 };

    // Create the marker with a custom icon.
    const marker = new google.maps.Marker({
      position: busStop,
      map: map,
      title: "Bus Stop",
      icon: {
        url: "bus_stop_icon.png",
        scaledSize: new google.maps.Size(32, 32),
      },
    });

    // HTML content for the InfoWindow
    const infoContent = `
      <div class="brts-container">
        <div class="title">Kargil Chowk BRTS</div>

        <div class="bus-item">
          <div class="bus-icon"><img src="bus.svg" alt="Bus" width="16" height="16"></div>
          <div class="bus-badge badge-blue">106S</div>
          <div class="bus-details">
            <div class="destination">ABHVA GAAM(Saraswati Mahavidh...)</div>
          </div>
          <div class="time"></div>
        </div>

        <div class="bus-item">
          <div class="bus-icon"><img src="bus.svg" alt="Bus" width="16" height="16"></div>
          <div class="bus-badge badge-blue">226J</div>
          <div class="bus-details">
            <div class="destination">Kosad Gam</div>
          </div>
          <div class="time"></div>
        </div>

        <div class="bus-item">
          <div class="bus-icon"><img src="bus.svg" alt="Bus" width="16" height="16"></div>
          <div class="bus-badge badge-red">14</div>
          <div class="bus-details">
            <div class="destination">Kosad Ews H2</div>
          </div>
          <div class="time"></div>
        </div>
        <div class="bus-item">
          <div class="bus-icon"><img src="bus.svg" alt="Bus" width="16" height="16"></div>
          <div class="bus-badge badge-blue">106S</div>
          <div class="bus-details">
            <div class="destination">ABHVA GAAM(Saraswati Mahavidh...)</div>
          </div>
          <div class="time"></div>
        </div>

        <div class="bus-item">
          <div class="bus-icon"><img src="bus.svg" alt="Bus" width="16" height="16"></div>
          <div class="bus-badge badge-blue">226J</div>
          <div class="bus-details">
            <div class="destination">Kosad Gam</div>
          </div>
          <div class="time"></div>
        </div>

        <div class="bus-item">
          <div class="bus-icon"><img src="bus.svg" alt="Bus" width="16" height="16"></div>
          <div class="bus-badge badge-red">14</div>
          <div class="bus-details">
            <div class="destination">Kosad Ews H2</div>
          </div>
          <div class="time"></div>
        </div>
      </div>
    `;

    // Create the InfoWindow with the content.
    const infoWindow = new google.maps.InfoWindow({
      content: infoContent,
    });

    // Variable to hold a timeout for closing the InfoWindow.
    let closeTimeout;

    // Helper functions to cancel or schedule closing.
    function cancelClose() {
      if (closeTimeout) {
        clearTimeout(closeTimeout);
        closeTimeout = null;
      }
    }

    function scheduleClose() {
      // Schedule closure after 200ms delay (adjust if needed)
      closeTimeout = setTimeout(() => {
        infoWindow.close();
      }, 200);
    }

    // When the mouse is over the marker, open the InfoWindow.
    marker.addListener("mouseover", () => {
      cancelClose();
      infoWindow.open(map, marker);
      
      // When the InfoWindow's DOM is ready, attach mouse events to its container.
      google.maps.event.addListenerOnce(infoWindow, 'domready', () => {
        // Query the container that holds our custom HTML.
        const container = document.querySelector('.brts-container');
        if (container) {
          // Cancel the close if the pointer enters the container.
          container.addEventListener('mouseenter', cancelClose);
          // When the pointer leaves the container, schedule closing.
          container.addEventListener('mouseleave', scheduleClose);
          // Insert the random times once the container is available.
          insertRandomTimes(container);
        }
      });
    });

    // When the mouse leaves the marker, schedule closing the InfoWindow.
    marker.addListener("mouseout", scheduleClose);
  }

  // Initialize the map when the window loads.
  window.onload = initMap;
</script>
</body>

</html>